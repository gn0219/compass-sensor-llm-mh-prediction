# Reasoning Methods and Output Constraints Configuration
# Defines different reasoning approaches and output formatting

metadata:
  name: "Reasoning & Output Configuration"
  version: "1.0"
  description: "Templates for reasoning instructions and output constraints"

# ============================================================================
# REASONING METHODS
# ============================================================================
reasoning_methods:
  # -------------------------
  # 1. Direct Prediction
  # -------------------------
  direct:
    name: "Direct"
    description: "Immediate prediction without explicit reasoning steps"
    instruction: |
      Based on the behavioral data provided, make your prediction.
    
    output_format: |
      Please provide your prediction in the following JSON format:
      {
        "Prediction": {
          "Anxiety": "Low Risk" or "High Risk",
          "Depression": "Low Risk" or "High Risk"
        }
      }
    
    # CES-specific output format (includes Stress)
    output_format_ces: |
      Please provide your prediction in the following JSON format:
      {
        "Prediction": {
          "Anxiety": "Low Risk" or "High Risk",
          "Depression": "Low Risk" or "High Risk",
          "Stress": "Low Risk" or "High Risk"
        }
      }
  
  # -------------------------
  # 2. Chain-of-Thought (CoT)
  # -------------------------
  cot:
    name: "Chain-of-Thought"
    description: "Step-by-step reasoning process"
    instruction: |
      Please think step-by-step about the behavioral patterns and provide your 
      reasoning before making a prediction.
      
      Follow these steps:
      1. **Observe Patterns**: Identify key behavioral features and their values
      2. **Compare to Clinical Knowledge**: Relate patterns to known indicators
      3. **Assess Risk Factors**: Evaluate presence of risk/protective factors
      4. **Make Prediction**: Provide final risk assessment
    
    output_format: |
      Please provide your response in the following JSON format:
      {
        "Step1_ObservePatterns": "Description of observed behavioral patterns",
        "Step2_CompareToClinicalKnowledge": "How these patterns compare to the clinical knowledge",
        "Step3_IdentifyRiskFactors": "Key risk or protective factors identified",
        "Step4_MakePrediction": "Final reasoning and prediction",
        "Prediction": {
          "Anxiety": "Low Risk" or "High Risk",
          "Depression": "Low Risk" or "High Risk"
        }
      }
    
    # CES-specific output format (includes Stress)
    output_format_ces: |
      Please provide your response in the following JSON format:
      {
        "Step1_ObservePatterns": "Description of observed behavioral patterns",
        "Step2_CompareToClinicalKnowledge": "How these patterns compare to the clinical knowledge",
        "Step3_IdentifyRiskFactors": "Key risk or protective factors identified",
        "Step4_MakePrediction": "Final reasoning and prediction",
        "Prediction": {
          "Anxiety": "Low Risk" or "High Risk",
          "Depression": "Low Risk" or "High Risk",
          "Stress": "Low Risk" or "High Risk"
        }
      }
  
  # -------------------------
  # 3. Self-Feedback (Self-Evolving)
  # -------------------------
  self_feedback:
    name: "Self-Feedback"
    description: "Iterative reasoning with self-assessment and refinement"
    
    initial_instruction: |
      Based on the behavioral data and any examples provided, analyze the patterns carefully and make your prediction.
      
      Provide your best judgment based on the current data. Be clear and direct - you will have 
      opportunities to refine later if needed.
      
      IMPORTANT: You must adhere to the following assessment rubric and output format.
      
      ## Difficulty Assessment Rubric
      You MUST classify the difficulty of this prediction based on the evidence quality:
      - Easy: Clear, converging evidence. 3+ consistent signals across modalities with minimal contradictions. 
        High confidence is appropriate. Further analysis unlikely to change conclusion.
      - Moderate: Mixed but interpretable evidence. 2+ signals with partial consistency, some contradictions 
        that don't override the main pattern. Requires careful weighing. Refinement may help clarify.
      - Difficult: Sparse, contradictory, or highly ambiguous evidence. <2 clear signals OR multiple strong 
        contradictions. Multiple interpretations possible. Further analysis unlikely to resolve ambiguity.

    initial_output_format: |
      Please provide your response in the following JSON format:
      {
        "Prediction": {
          "Anxiety": "Low Risk" or "High Risk",
          "Depression": "Low Risk" or "High Risk"
        },
        "Confidence": {
          "Anxiety": "High" or "Medium" or "Low",
          "Depression": "High" or "Medium" or "Low"
        },
        "Key_Insights": "Summarize the main patterns and indicators you observed in 2-3 sentences",
        "Difficulty": "Easy" or "Moderate" or "Difficult",
        "Challenges": "Explain why you chose this difficulty level based on the Rubric. For 'Easy', explain what made it clear. For 'Moderate', what aspects are mixed? For 'Difficult', why is it ambiguous?",
        "Focus_Areas_for_Refinement": "If Moderate or Difficult: what specific aspects should be examined more carefully in the next analysis? If Easy: state 'None - evidence is clear'."
      }
    
    # CES-specific initial output format (includes Stress)
    initial_output_format_ces: |
      Please provide your response in the following JSON format:
      {
        "Prediction": {
          "Anxiety": "Low Risk" or "High Risk",
          "Depression": "Low Risk" or "High Risk",
          "Stress": "Low Risk" or "High Risk"
        },
        "Confidence": {
          "Anxiety": "High" or "Medium" or "Low",
          "Depression": "High" or "Medium" or "Low",
          "Stress": "High" or "Medium" or "Low"
        },
        "Key_Insights": "Summarize the main patterns and indicators you observed in 2-3 sentences",
        "Difficulty": "Easy" or "Moderate" or "Difficult",
        "Challenges": "Explain why you chose this difficulty level based on the Rubric. For 'Easy', explain what made it clear. For 'Moderate', what aspects are mixed? For 'Difficult', why is it ambiguous?",
        "Focus_Areas_for_Refinement": "If Moderate or Difficult: what specific aspects should be examined more carefully in the next analysis? If Easy: state 'None - evidence is clear'."
      }
    
    refinement_instruction: |
      You previously made a prediction that was marked as difficulty: {difficulty}. Here is your previous analysis:
      
      {previous_response}
      
      ---
      
      Now, REFINE this prediction by carefully re-examining the data.
      
      **Phase 1 — Evidence Review**
      - Systematically re-examine the data, focusing on the "Focus_Areas_for_Refinement" from your previous analysis
      - Look for patterns you may have initially overlooked or misinterpreted
      - Identify both supporting and conflicting evidence objectively (list at most 2-3 points each)
      - Do not speculate about causes that are not evidenced in the data
      
      **Phase 2 — Refinement Decision**
      Based on your re-examination, decide on your refined prediction:
      
      **When to KEEP your prediction:**
      - Supporting evidence remains stronger than conflicting evidence
      - New examination confirms your initial interpretation
      - Contradictions are minor or explainable
      
      **When to CHANGE your prediction:**
      - You discover strong contradicting evidence that outweighs previous supporting signals
      - Initial interpretation was clearly flawed upon re-examination
      - Multiple modalities consistently contradict your initial prediction
      
      **Critical Principle: Prefer Stability**
      - Only change your prediction if you find STRONG new evidence
      - Acknowledging uncertainty (via confidence/difficulty) is better than forced changes
      - Most refinements should adjust confidence or difficulty, not flip predictions
      
      **Phase 3 — Difficulty Re-assessment**
      Re-evaluate the difficulty based on your refined understanding:
      
      - **Easy**: Clear converging evidence (3+ signals), minimal contradictions, high confidence appropriate
      - **Moderate**: Mixed but interpretable signals (2+ signals), some contradictions, genuine middle ground
      - **Difficult**: Sparse/contradictory evidence (<2 clear signals OR strong conflicts), multiple interpretations
      
      **Difficulty Transition Guidelines:**
      
      From Previous "Easy":
      - Stay Easy if re-examination confirmed clear, converging evidence
      - Move to Moderate if you discovered some conflicting signals or nuances
      - Move to Difficult is rare (only if you completely misread initially)
      
      From Previous "Moderate":
      - Move to Easy if re-examination clarified the case (conflicting signals were minor or explained)
      - Move to Difficult if ambiguity deepened (revealed more contradictions than initially apparent)
      - Stay Moderate if evidence genuinely remains mixed but interpretable - this is a VALID state
      
      From Previous "Difficult":
      - Stay Difficult if ambiguity persists (expected - accept the uncertainty)
      - Move to Moderate if you found some structure in the data
      - Move to Easy if data is actually quite clear (initial assessment was too pessimistic)
      
      **Important**: Many cases are genuinely Moderate. Don't force Easy or Difficult if evidence truly remains mixed.
      
      (Difficulty Rubric for reference)
      - **Easy:** Re-examination confirmed clear, converging evidence. Further analysis unlikely to change conclusion.
      - **Moderate:** Evidence remains mixed but interpretable - a valid final state for borderline cases.
      - **Difficult:** Data remains fundamentally ambiguous - accept the uncertainty. Further analysis won't help.

    refinement_output_format: |
      Please provide your refined response in the following JSON format:
      {
        "Refined_Prediction": {
          "Anxiety": "Low Risk" or "High Risk",
          "Depression": "Low Risk" or "High Risk"
        },
        "Confidence": {
          "Anxiety": "High" or "Medium" or "Low",
          "Depression": "High" or "Medium" or "Low"
        },
        "Counter_Evidence": "Briefly list the strongest evidence AGAINST your refined prediction (2-3 points max). If none, state 'None identified'.",
        "Refined_Analysis": "Explain what you learned from re-examination and why your refined prediction is appropriate despite any counter-evidence.",
        "Difficulty": "Easy" or "Moderate" or "Difficult",
        "Changes_from_Initial": "Explicitly state: (1) What changed in prediction/confidence/difficulty? (2) WHY it changed OR why it remained the same.",
        "Challenges": "If new Difficulty is 'Moderate' or 'Difficult', explain the remaining challenges. If Easy: empty string.",
        "Focus_Areas_for_Refinement": "If new Difficulty is 'Moderate' or 'Difficult': what specific aspects need examination in the next round? If Easy: 'Analysis complete - evidence is clear'. If Difficult: 'Further analysis unlikely to help - accepting uncertainty'."
      }
    
    # CES-specific refinement output format (includes Stress)
    refinement_output_format_ces: |
      Please provide your refined response in the following JSON format:
      {
        "Refined_Prediction": {
          "Anxiety": "Low Risk" or "High Risk",
          "Depression": "Low Risk" or "High Risk",
          "Stress": "Low Risk" or "High Risk"
        },
        "Confidence": {
          "Anxiety": "High" or "Medium" or "Low",
          "Depression": "High" or "Medium" or "Low",
          "Stress": "High" or "Medium" or "Low"
        },
        "Counter_Evidence": "Briefly list the strongest evidence AGAINST your refined prediction (2-3 points max). If none, state 'None identified'.",
        "Refined_Analysis": "Explain what you learned from re-examination and why your refined prediction is appropriate despite any counter-evidence.",
        "Difficulty": "Easy" or "Moderate" or "Difficult",
        "Changes_from_Initial": "Explicitly state: (1) What changed in prediction/confidence/difficulty? (2) WHY it changed OR why it remained the same.",
        "Challenges": "If new Difficulty is 'Moderate' or 'Difficult', explain the remaining challenges. If Easy: empty string.",
        "Focus_Areas_for_Refinement": "If new Difficulty is 'Moderate' or 'Difficult': what specific aspects need examination in the next round? If Easy: 'Analysis complete - evidence is clear'. If Difficult: 'Further analysis unlikely to help - accepting uncertainty'."
      }

# Output constraints
# output_constraints:
  # header: "## Guidelines"
  # do_header: "\n**DO:**"
  # do:
  #   - "Consider temporal patterns (long-term trends, recent changes, deltas if provided)"
  #   - "Cite specific features you used and tie them to clinical associations"
  #   - "Follow the exact output schema"
  
  # dont_header: "\n**DON'T:**"
  # dont:
  #   - "Don't predict 'Medium Risk' - only Low Risk or High Risk"
  
  # # Response format requirements
  # format_requirements:
  #   response_type: "json"
  #   ensure_parseable: true
  #   prediction_format: "Must be exactly 'Low Risk' or 'High Risk'"
  #   required_fields:
  #     - "Prediction"
  #     - "Anxiety"
  #     - "Depression"
  
  # # Reasoning quality guidelines
  # reasoning_quality:
  #   - "Be specific: cite actual feature values"
  #   - "Be balanced: consider both risk and protective factors"
  #   - "Be evidence-based: link observations to clinical knowledge"
  #   - "Be concise: focus on the most relevant patterns"

# ============================================================================
# TASK COMPLETION PROMPT
# ============================================================================
task_completion:
  header: "## Your Prediction Task"
  instruction: |
    Now, please analyze the following user's behavioral data and provide your 
    prediction for their anxiety and depression risk levels.
  
  # CES-specific instruction (includes stress)
  instruction_ces: |
    Now, please analyze the following user's behavioral data and provide your 
    prediction for their anxiety, depression, and stress risk levels.
  
  # MentalIoT-specific instruction (same as CES, includes stress)
  instruction_mentaliot: |
    Now, please analyze the following user's behavioral data and provide your 
    prediction for their anxiety, depression, and stress risk levels.
  
  data_header: "### User Data to Predict"
  
  reminder: |
    Remember to:
    - Consider all available features
    - Follow the specified reasoning method
    - Use the exact output format required
    - Provide clear, evidence-based reasoning

